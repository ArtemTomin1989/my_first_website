<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Edit Profile</title>
    <link rel="stylesheet" href="/css/profile/edit_profile.css" />
  </head>
  <body>
    <%- include("../partials/header") %>

    <!-- error or success message -->
    <% if (alert_type && message) { %>
    <p class="<%=alert_type%>"><%= message %></p>
    <% } %>

    <h1>Edit Profile</h1>

    <form action="/edit_profile" method="POST" enctype="multipart/form-data">
      <% if (user.avatar) { %>
      <div>
        <p>Current avatar:</p>
        <img src="<%= user.avatar %>" alt="Avatar" style="max-width: 200px" />
        <input type="hidden" name="old_avatar" value="<%= user.avatar %>" />
      </div>
      <% } %> <% if (user.public_id) { %>
      <input type="hidden" name="old_public_id" value="<%= user.public_id %>" />
      <% } %>

      <div>
        <label for="avatar">Upload new avatar:</label>
        <input type="file" name="avatar" />
      </div>

      <label for="nickname">Nickname</label>
      <input
        type="text"
        id="nickname"
        name="nickname"
        value="<%= user.nickname %>"
        required
      />

      <label for="age">Age</label>
      <input type="number" id="age" name="age" value="<%= user.age %>" />

      <label for="bio">Bio</label>
      <textarea id="bio" name="bio" rows="3"><%= user.bio %></textarea>

      <label for="phoneNumber">Phone Number</label>
      <input
        type="tel"
        id="phoneNumber"
        name="phoneNumber"
        value="<%= user.phoneNumber %>"
      />

      <label for="location">City</label>
      <input
        type="text"
        id="location"
        name="location"
        value="<%= user.location %>"
      />

      <button type="submit">Save Changes</button>
    </form>

    <button id="showDeleteFormBtn">Delete Account</button>

    <div id="modalOverlay" style="display: none">
      <div id="deleteModal">
        <form
          id="deleteForm"
          action="/edit_profile/delete_profile"
          method="POST"
        >
          <label for="password">Enter your password to confirm:</label>
          <input type="password" id="password" name="password" required />

          <div style="margin-top: 10px">
            <button type="submit">Confirm Delete</button>
            <button type="button" id="cancelDeleteBtn">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <a href="/my_profile">Back to Profile</a>

    <script src="/scripts/profile/edit_profile.js"></script>
  </body>
</html>
